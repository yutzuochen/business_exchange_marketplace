# syntax=docker/dockerfile:1.7

# Dev stage（compose 的 build.target: dev 會指向這裡）
FROM golang:1.24-alpine AS dev
WORKDIR /app

RUN apk add --no-cache git curl ca-certificates tzdata
ENV GO111MODULE=on \
    GOCACHE=/go/cache \
    CGO_ENABLED=0 \
    PATH="/go/bin:${PATH}"

# 熱重載（新維護倉庫）
RUN go install github.com/air-verse/air@latest

# 先快取依賴
COPY go.mod go.sum ./
RUN --mount=type=cache,target=/go/pkg/mod go mod download

# 程式碼（dev 時會用 bind mount 蓋掉，仍保留可獨立啟動）
COPY . .

EXPOSE 8080
# 預設用 air；若你有 .air.toml，compose 可不用覆蓋 command
CMD ["air", "-c", ".air.toml"]
